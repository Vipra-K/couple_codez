generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  fullName  String?
  gender    String?
  profilePic String?
  coupleId  String?
  pairCode  String?   @unique
  couple    Couple?   @relation(fields: [coupleId], references: [id])
  messages  Message[]
  fcmToken  String?
  createdAt DateTime  @default(now())
}

model Couple {
  id            String    @id @default(uuid())
  code          String    @unique
  
  themeTemplateId String?
  themeTemplate   ThemeTemplate? @relation(fields: [themeTemplateId], references: [id])

  users         User[]
  messages      Message[]
  lastMessageAt DateTime?
  createdAt     DateTime  @default(now())
}

model ThemeTemplate {
  id        String   @id @default(uuid())
  name      String   @unique

  // Background control
  backgroundType ChatBackgroundType

  // COLOR
  backgroundColor String?

  // GRADIENT
  gradientStartColor String?
  gradientEndColor   String?
  gradientAngle      Int? // 0â€“360

  // IMAGE
  backgroundImageUrl String?

  // Message bubbles
  senderBubbleColor   String
  receiverBubbleColor String
  senderTextColor     String
  receiverTextColor   String

  accentColor String

  couples   Couple[]
  createdAt DateTime @default(now())
}

enum ChatBackgroundType {
  COLOR
  GRADIENT
  IMAGE
}

model Message {
  id        String   @id @default(uuid())

  coupleId  String
  couple    Couple   @relation(fields: [coupleId], references: [id])

  senderId  String
  sender    User     @relation(fields: [senderId], references: [id])

  type      MessageType
  content   String

  status    MessageStatus @default(SENT)
  driveFileId String?

  createdAt DateTime @default(now())
  deletedAt DateTime?

  replyToId       String?
  replyToContent  String?
  replyToSenderId String?
  replyToType     String?
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
}